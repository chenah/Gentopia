# MATHVC - 数学教育虚拟协作系统

MATHVC是一个基于Gentopia框架和Qwen大模型的数学教育虚拟协作系统，旨在通过多个角色代理的协作，为用户提供个性化的数学学习体验。

## 系统架构

MATHVC系统由以下核心组件构成：

1. **Qwen大模型集成**：使用Qwen/Qwen3-Next-80B-A3B-Instruct模型作为底层语言模型
2. **多角色代理系统**：包含元规划器、学生代理、教师代理、专家代理和评估代理
3. **Web交互界面**：基于Flask的Web应用，提供用户友好的交互界面
4. **对话管理**：支持对话历史记录和管理

## 角色代理说明

### 1. 元规划器 (Metaplanner)
- **职责**：分析用户任务，制定执行计划，协调其他代理
- **特点**：具有全局视角，能够理解复杂任务并分解为子任务

### 2. 学生代理 (Student Agent)
- **职责**：模拟学生思维，提出问题和困惑，表达学习需求
- **特点**：从学习者的角度思考问题，帮助系统理解用户的学习状态

### 3. 教师代理 (Teacher Agent)
- **职责**：提供指导和解释，设计教学内容，回答基础问题
- **特点**：具有教学专业知识，能够提供清晰易懂的解释

### 4. 专家代理 (Expert Agent)
- **职责**：提供专业知识和深入分析，解决复杂问题
- **特点**：具有深厚的数学专业知识，能够处理高难度问题

### 5. 评估代理 (Evaluator Agent)
- **职责**：评估解决方案和学习效果，提供反馈和改进建议
- **特点**：具有评估专业知识，能够客观评价学习成果

## 安装和配置

### 1. 环境要求
- Python 3.8+
- Gentopia框架
- Flask
- 其他依赖项（见requirements.txt）

### 2. 安装步骤
1. 克隆或下载项目代码
2. 安装依赖项：
   ```
   pip install -r requirements.txt
   ```

### 3. 配置Qwen API
在系统配置文件中设置Qwen API的访问信息：
- 模型名称：Qwen/Qwen3-Next-80B-A3B-Instruct
- 基础URL：https://api-inference.modelscope.cn/v1
- API密钥：您的ModelScope Token

## 使用方法

### 1. 命令行界面
运行测试脚本验证系统功能：
```
python test_mathvc.py
```

### 2. Web界面
启动Web应用：
```
python web_app.py
```

然后在浏览器中访问：http://localhost:5000

### 3. 编程接口
```python
from mathvc_system import MATHVCSystem

# 初始化系统
mathvc = MATHVCSystem()

# 处理任务
response = mathvc.process_task("请解释一下什么是勾股定理")
print(response)

# 获取对话历史
history = mathvc.get_conversation_history()

# 清空对话历史
mathvc.clear_conversation_history()
```

## 示例对话

### 示例1：基础概念解释
**用户**：请解释一下什么是二次函数？

**系统响应**：
```
# MATHVC系统响应

## 任务描述
请解释一下什么是二次函数？

## 执行计划
分析用户对二次函数概念的学习需求，制定解释计划。

## 各角色代理响应

### 学生代理
作为一个学生，我想了解二次函数的基本概念。二次函数是什么？它和一次函数有什么区别？在现实生活中有什么应用？

### 教师代理
二次函数是形如f(x) = ax² + bx + c（其中a≠0）的函数。它是一种多项式函数，最高次项为2。

二次函数与一次函数的主要区别在于：
1. 一次函数的图像是一条直线，而二次函数的图像是一条抛物线。
2. 一次函数的变化率是恒定的，而二次函数的变化率是变化的。

二次函数在现实生活中有很多应用，例如：
- 物理学中的抛物运动
- 经济学中的成本和收益分析
- 工程学中的优化问题

### 专家代理
从数学分析的角度看，二次函数f(x) = ax² + bx + c具有以下重要性质：

1. 定义域为实数集R，值域取决于a的符号：
   - 当a > 0时，值域为[f(-b/2a), +∞)
   - 当a < 0时，值域为(-∞, f(-b/2a))

2. 函数的对称轴为x = -b/(2a)

3. 函数的顶点为(-b/(2a), f(-b/(2a)))

4. 判别式Δ = b² - 4ac决定了函数与x轴的交点情况：
   - Δ > 0：两个不同的实数根
   - Δ = 0：一个实数根（重根）
   - Δ < 0：无实数根

## 评估结果
各代理的响应全面且互补。学生代理提出了学习者可能关心的问题，教师代理提供了基础概念解释和实际应用，专家代理则深入分析了数学性质。整体响应结构清晰，内容丰富，能够满足用户对二次函数概念的学习需求。

## 总结
以上是MATHVC系统对您任务的综合响应。系统通过多个角色代理的协作，提供了多角度的分析和解决方案。
```

### 示例2：问题解决
**用户**：如何求解方程x² - 5x + 6 = 0？

**系统响应**：
```
# MATHVC系统响应

## 任务描述
如何求解方程x² - 5x + 6 = 0？

## 执行计划
分析二次方程求解问题，提供多种解法并解释原理。

## 各角色代理响应

### 学生代理
我需要解这个二次方程x² - 5x + 6 = 0。我记得老师讲过可以用因式分解或公式法来解，但我不太确定具体步骤。这个方程的解是什么？有没有简单的方法？

### 教师代理
解二次方程x² - 5x + 6 = 0，我们可以使用以下几种方法：

**方法1：因式分解法**
我们需要找到两个数，它们的乘积是6，和是-5。
这两个数是-2和-3，因为(-2)×(-3)=6，(-2)+(-3)=-5。
所以，x² - 5x + 6 = (x - 2)(x - 3) = 0
因此，x = 2 或 x = 3

**方法2：公式法**
对于一般形式的二次方程ax² + bx + c = 0，解为：
x = (-b ± √(b² - 4ac)) / (2a)

对于x² - 5x + 6 = 0，a=1, b=-5, c=6
x = (5 ± √((-5)² - 4×1×6)) / (2×1)
x = (5 ± √(25 - 24)) / 2
x = (5 ± √1) / 2
所以，x = 3 或 x = 2

### 专家代理
从代数理论的角度，二次方程x² - 5x + 6 = 0的求解可以更深入地分析：

**1. 判别式分析**
判别式Δ = b² - 4ac = (-5)² - 4×1×6 = 25 - 24 = 1 > 0
这表明方程有两个不同的实数根。

**2. 韦达定理**
对于方程x² - 5x + 6 = 0，根据韦达定理：
- 两根之和：x₁ + x₂ = -b/a = 5
- 两根之积：x₁ × x₂ = c/a = 6

我们可以验证：2 + 3 = 5，2 × 3 = 6，符合韦达定理。

**3. 函数图像分析**
考虑函数f(x) = x² - 5x + 6，其图像是一条开口向上的抛物线。
函数的顶点在x = -b/(2a) = 5/2 = 2.5处
f(2.5) = (2.5)² - 5×2.5 + 6 = 6.25 - 12.5 + 6 = -0.25
由于顶点在x轴下方且开口向上，函数图像与x轴有两个交点，即方程有两个实数根。

**4. 数值方法**
除了解析解，我们还可以使用数值方法如牛顿迭代法求解：
选择初始值x₀ = 0，迭代公式为：
x_{n+1} = x_n - f(x_n)/f'(x_n) = x_n - (x_n² - 5x_n + 6)/(2x_n - 5)

经过几次迭代，可以收敛到x = 2或x = 3。

## 评估结果
各代理的解答全面且层次分明。学生代理提出了初学者可能遇到的问题，教师代理提供了清晰易懂的解法步骤，专家代理则从理论高度进行了深入分析。整体解答不仅给出了问题的答案，还提供了多种解法和理论背景，能够满足不同层次学习者的需求。

## 总结
以上是MATHVC系统对您任务的综合响应。系统通过多个角色代理的协作，提供了多角度的分析和解决方案。
```

## 系统扩展

MATHVC系统设计为可扩展的架构，您可以通过以下方式扩展系统功能：

1. **添加新的角色代理**：创建新的配置文件并实现相应的代理类
2. **集成其他大模型**：通过实现新的客户端类，支持其他大模型
3. **添加新的工具插件**：为代理添加特定的工具能力，如计算器、绘图工具等
4. **定制化提示模板**：根据特定需求修改代理的提示模板

## 常见问题

### Q: 如何更换Qwen模型？
A: 在配置文件中修改model_name参数为您想要使用的Qwen模型名称。

### Q: 系统响应速度慢怎么办？
A: 可以尝试以下方法：
1. 减少各代理的提示词长度
2. 调整模型参数，如降低max_tokens
3. 使用性能更强的计算资源

### Q: 如何添加新的数学主题支持？
A: 可以通过修改代理的提示模板，添加特定数学主题的知识和指导方法。

## 文件结构

```
f:\Gentopia\
├── gentopia\                    # Gentopia框架核心代码
│   ├── llm\                     # 大模型客户端
│   │   ├── client\              # 客户端实现
│   │   │   ├── openai.py        # OpenAI客户端
│   │   │   ├── qwen.py          # Qwen客户端（新增）
│   │   │   └── ...
│   │   ├── llm_info.py          # 模型信息（已修改）
│   │   └── ...
│   ├── assembler\               # 代理组装器
│   │   └── agent_assembler.py   # 代理组装器（已修改）
│   └── ...
├── configs\                     # 配置文件目录
│   ├── mathvc_metaplanner.yaml  # 元规划器配置
│   ├── mathvc_student.yaml      # 学生代理配置
│   ├── mathvc_teacher.yaml      # 教师代理配置
│   ├── mathvc_expert.yaml       # 专家代理配置
│   └── mathvc_evaluator.yaml    # 评估代理配置
├── templates\                   # Web模板
│   └── index.html               # Web界面模板
├── mathvc_system.py             # MATHVC系统主类
├── web_app.py                   # Web应用
├── test_mathvc.py               # 测试脚本
└── README_MATHVC.md             # MATHVC系统文档
```

## 许可证

本项目遵循Gentopia框架的MIT许可证。

---

© 2023 MATHVC团队. 基于Gentopia框架构建.